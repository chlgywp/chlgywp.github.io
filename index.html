<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¬ì—°ì˜ ë¬´ì—­ (Abyssal Trade) - Analyst Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Pretendard:wght@100..900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #020617;
            color: #f8fafc;
            overflow: hidden;
        }

        .font-mono { font-family: 'JetBrains Mono', monospace; }

        .glass-panel {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        /* ì‹œì‘ í™”ë©´ ì˜¤ë²„ë ˆì´ */
        #start-screen {
            position: fixed;
            inset: 0;
            z-index: 300;
            background: radial-gradient(circle at center, #1e293b 0%, #020617 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease;
        }

        /* ë¦¬í¬íŠ¸ ì˜¤ë²„ë ˆì´ (êµ¬ ë„¤ë¹„ê²Œì´ì…˜) */
        #report-overlay {
            position: fixed;
            inset: 0;
            z-index: 100;
            background: rgba(2, 6, 23, 0.98);
            backdrop-filter: blur(10px);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
        }

        .ocean-bg {
            position: absolute;
            width: 200%;
            height: 100%;
            background: repeating-linear-gradient(90deg, transparent, transparent 50px, rgba(255,255,255,0.02) 50px, rgba(255,255,255,0.02) 100px);
            animation: wave 10s linear infinite;
            opacity: 0.3;
            pointer-events: none;
        }

        @keyframes wave {
            from { transform: translateX(0); }
            to { transform: translateX(-1000px); }
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        
        .tutorial-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1.5rem;
            border-radius: 1rem;
            text-align: left;
        }
        
        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .report-table th { text-align: left; color: #94a3b8; font-size: 0.75rem; text-transform: uppercase; padding-bottom: 0.5rem; }
        .report-table td { padding: 0.5rem 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
    </style>
</head>
<body class="h-screen overflow-hidden">

    <div id="start-screen">
        <div class="max-w-4xl w-full p-8 text-center relative z-10">
            <div class="mb-2 text-indigo-500 font-bold tracking-[0.5em] uppercase text-sm animate-pulse">Deep Sea Logistics Simulator</div>
            <h1 class="text-7xl md:text-8xl font-black text-white mb-6 italic tracking-tighter" style="text-shadow: 0 0 60px rgba(99,102,241,0.5);">
                ABYSSAL<br><span class="text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-indigo-500">TRADE</span>
            </h1>
            
            <p class="text-slate-400 text-lg mb-12 max-w-2xl mx-auto leading-relaxed">
                ì„¸ê³„ ê²½ì œê°€ ë¶•ê´´ëœ ê·¼ë¯¸ë˜. ë‹¹ì‹ ì€ ê±°ëŒ€ í™”ë¬¼ì„ ì˜ ì„ ì¥ì…ë‹ˆë‹¤.<br>
                ë‰´ìŠ¤ë¥¼ ë¯¸ë¦¬ ì…ìˆ˜í•˜ì—¬ ì‹œì„¸ ì°¨ìµì„ ë‚¨ê¸°ê³ , 10ì¼ê°„ íŒŒì‚°í•˜ì§€ ì•Šê³  ìƒì¡´í•˜ì‹­ì‹œì˜¤.
            </p>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12 text-left">
                <div class="tutorial-card">
                    <div class="text-3xl mb-3">ğŸ“°</div>
                    <h3 class="font-bold text-white mb-2">1. ë‰´ìŠ¤ë¥¼ ì½ê³  ì¶”ë¡ </h3>
                    <p class="text-sm text-slate-400">í™”ë©´ì˜ ë‰´ìŠ¤ëŠ” <strong>ë‚´ì¼ ì¼ì–´ë‚  ì¼</strong>ì…ë‹ˆë‹¤. "ì „ìŸ" ë‰´ìŠ¤ê°€ ëœ¨ë©´ ë‚´ì¼ "ë¬´ê¸°" ê°€ê²©ì´ ì˜¤ë¥¼ ê²ƒì„ ì˜ˆì¸¡í•´ì•¼ í•©ë‹ˆë‹¤.</p>
                </div>
                <div class="tutorial-card">
                    <div class="text-3xl mb-3">ğŸ“¦</div>
                    <h3 class="font-bold text-white mb-2">2. ì„ ë§¤ìˆ˜ í›„ë§¤ë„</h3>
                    <p class="text-sm text-slate-400">ì˜¤ë¥¼ ê²ƒ ê°™ì€ ë¬¼ê±´ì€ ë¯¸ë¦¬ ì‚¬ë‘ê³ , ì•…ì¬ê°€ ëœ¬ ë¬¼ê±´ì€ í­ë½í•˜ê¸° ì „ì— ì²˜ë¶„í•˜ì„¸ìš”.</p>
                </div>
                <div class="tutorial-card">
                    <div class="text-3xl mb-3">ğŸš¢</div>
                    <h3 class="font-bold text-white mb-2">3. í•­í•´ì™€ ê²°ê³¼ í™•ì¸</h3>
                    <p class="text-sm text-slate-400">ì¶œí•­í•˜ë©´ í•˜ë£¨ê°€ ì§€ë‚˜ê³ , ë‹¹ì‹ ì˜ ì˜ˆì¸¡ì´ ë§ì•˜ëŠ”ì§€ ë³´ì—¬ì£¼ëŠ” <strong>ìƒì„¸ ë¦¬í¬íŠ¸</strong>ê°€ ë„ì°©í•©ë‹ˆë‹¤.</p>
                </div>
            </div>

            <button onclick="startGame()" class="bg-white text-black text-xl font-black py-5 px-12 rounded-full hover:scale-105 hover:shadow-[0_0_40px_rgba(255,255,255,0.3)] transition-all duration-300">
                í•­í•´ ì‹œì‘í•˜ê¸°
            </button>
        </div>
        <div class="ocean-bg"></div>
    </div>

    <div id="report-overlay">
        <div class="max-w-3xl w-full p-6 relative z-10 flex flex-col h-screen md:h-auto max-h-screen">
            <div class="glass-panel p-8 rounded-3xl border border-indigo-500/30 shadow-2xl overflow-y-auto">
                <div class="text-center mb-8">
                    <h2 class="text-indigo-400 font-bold tracking-[0.5em] uppercase text-xs mb-2">Daily Market Analysis</h2>
                    <h1 class="text-4xl font-black text-white italic">ì¼ì¼ í•­í•´ ë¦¬í¬íŠ¸</h1>
                </div>

                <div class="bg-slate-900/50 p-6 rounded-2xl border border-slate-700 mb-8">
                    <div class="flex items-start gap-4">
                        <div class="text-4xl">ğŸ“¢</div>
                        <div>
                            <h3 class="text-slate-400 text-xs font-bold uppercase mb-1">ì–´ì œ ë°œìƒí•œ ì£¼ìš” ì´ìŠˆ</h3>
                            <p id="report-event-title" class="text-xl font-bold text-white mb-2">ì´ìŠˆ ì œëª©</p>
                            <div class="bg-indigo-900/30 p-3 rounded-lg border-l-4 border-indigo-500">
                                <p class="text-xs text-indigo-300 font-bold mb-1">ğŸ“Š ì‹œì¥ ë¶„ì„ê°€ ì½”ë©˜íŠ¸</p>
                                <p id="report-analysis" class="text-sm text-indigo-100 italic">"ë¶„ì„ ë‚´ìš©ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤."</p>
                            </div>
                        </div>
                    </div>
                </div>

                <h3 class="text-slate-400 text-xs font-bold uppercase mb-4">í’ˆëª©ë³„ ì‹œì„¸ ë³€ë™ í˜„í™©</h3>
                <div class="overflow-x-auto mb-8">
                    <table class="w-full text-sm report-table">
                        <thead>
                            <tr>
                                <th>í’ˆëª©</th>
                                <th>ì–´ì œ ê°€ê²©</th>
                                <th>ì˜¤ëŠ˜ ê°€ê²©</th>
                                <th>ë³€ë™ë¥ </th>
                                <th>ë³´ìœ ëŸ‰</th>
                            </tr>
                        </thead>
                        <tbody id="report-table-body">
                            </tbody>
                    </table>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-8">
                    <div class="bg-slate-950 p-4 rounded-xl border border-slate-800">
                        <p class="text-xs text-slate-500 font-bold uppercase">í•­í•´ ë° ë³´ê´€ ë¹„ìš©</p>
                        <p id="report-cost" class="text-xl font-mono text-rose-400 font-bold">- â‚© 0</p>
                    </div>
                    <div class="bg-slate-950 p-4 rounded-xl border border-slate-800">
                        <p class="text-xs text-slate-500 font-bold uppercase">í˜„ì¬ ì´ ìì‚° (í˜„ê¸ˆ)</p>
                        <p id="report-balance" class="text-xl font-mono text-emerald-400 font-bold">â‚© 0</p>
                    </div>
                </div>

                <button onclick="continueToNextDay()" class="w-full bg-white text-black font-black py-4 rounded-xl text-lg hover:bg-indigo-50 transition-colors shadow-[0_0_20px_rgba(255,255,255,0.2)]">
                    ë‹¤ìŒ ë‚  ì¼ì • ì‹œì‘ (Day <span id="next-day-idx">2</span>)
                </button>
            </div>
        </div>
        <div class="ocean-bg"></div>
    </div>

    <div id="app" class="h-full flex flex-col p-4 md:p-6 max-w-[1600px] mx-auto opacity-0 transition-opacity duration-1000">
        <header class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6 flex-shrink-0">
            <div class="glass-panel p-4 rounded-2xl border-l-4 border-emerald-500 stats-card">
                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-tighter">ê°€ìš© ìì‚°</p>
                <p id="money-display" class="text-2xl font-black text-emerald-400 font-mono italic">â‚© 5,000,000</p>
            </div>
            <div class="glass-panel p-4 rounded-2xl border-l-4 border-amber-500 stats-card">
                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-tighter">ì—ë„ˆì§€ ì§€ìˆ˜ (WTI)</p>
                <p id="oil-display" class="text-2xl font-black text-amber-500 font-mono italic">$ 95.00</p>
            </div>
            <div class="glass-panel p-4 rounded-2xl border-l-4 border-rose-500 stats-card">
                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-tighter">ì¼ì¼ ìˆ˜ì… í•œë„</p>
                <div class="flex items-center gap-3 mt-1">
                    <div class="flex-grow bg-slate-900 h-2.5 rounded-full overflow-hidden border border-slate-800">
                        <div id="quota-progress" class="bg-rose-500 h-full transition-all duration-700" style="width: 100%"></div>
                    </div>
                    <span id="quota-text" class="text-xs font-black font-mono">5/5</span>
                </div>
            </div>
            <div class="glass-panel p-4 rounded-2xl border-l-4 border-indigo-500 stats-card">
                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-tighter">ë‚¨ì€ ê¸°ê°„</p>
                <p id="day-display" class="text-2xl font-black text-indigo-400 font-mono italic">01 / 10</p>
            </div>
        </header>

        <main class="flex-grow grid grid-cols-1 lg:grid-cols-12 gap-6 min-h-0">
            <div class="lg:col-span-8 flex flex-col gap-6 overflow-hidden">
                <section class="glass-panel rounded-[2.5rem] p-8 border border-slate-800 relative bg-gradient-to-br from-indigo-950/30 to-transparent flex-shrink-0">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <span class="bg-rose-600 text-white text-xs px-3 py-1 rounded-full font-black italic tracking-widest animate-pulse">BREAKING NEWS</span>
                            <h2 class="text-sm font-bold text-slate-500 uppercase tracking-[0.4em]">ìµì¼ ì‹œì¥ ì „ë§ (Forecast)</h2>
                        </div>
                    </div>
                    <h3 id="news-headline" class="text-2xl md:text-3xl font-black mb-3 text-white leading-tight tracking-tight">ë‰´ìŠ¤ ë°ì´í„° ìˆ˜ì‹  ì¤‘...</h3>
                    <p id="news-content" class="text-indigo-200 text-base md:text-lg leading-relaxed max-w-4xl font-medium">ì´ ë‰´ìŠ¤ëŠ” ë‚´ì¼ ì‹œì¥ ê°€ê²©ì— ë°˜ì˜ë©ë‹ˆë‹¤. ë¯¸ë¦¬ ëŒ€ë¹„í•˜ì‹­ì‹œì˜¤.</p>
                </section>

                <div id="market-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4 overflow-y-auto pr-2 pb-4"></div>
            </div>

            <aside class="lg:col-span-4 flex flex-col gap-4 overflow-hidden">
                
                <div class="glass-panel p-5 rounded-3xl border border-emerald-500/30 bg-emerald-950/10 flex-shrink-0">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="text-xs font-black text-emerald-400 uppercase tracking-widest flex items-center gap-2">
                            <span>âš¡</span> ë©”ì¸ ì—”ì§„ íŠœë‹
                        </h4>
                        <span id="ship-lvl-badge" class="bg-emerald-500 text-black text-[10px] font-bold px-2 py-0.5 rounded shadow-[0_0_10px_rgba(16,185,129,0.5)]">Lv.0</span>
                    </div>
                    <div class="flex justify-between items-end mb-4">
                        <div>
                            <p class="text-[10px] text-slate-400 mb-1">í˜„ì¬ ì—°ë£Œ íš¨ìœ¨</p>
                            <p id="fuel-eff-display" class="text-xl font-mono font-bold text-white">0% ì ˆê°</p>
                        </div>
                        <div class="text-right">
                            <p class="text-[10px] text-slate-400 mb-1">ë‹¤ìŒ ë ˆë²¨ íš¨ê³¼</p>
                            <p class="text-sm font-mono font-bold text-emerald-400">+12%</p>
                        </div>
                    </div>
                    <button onclick="buyUpgrade()" id="btn-upgrade" class="w-full bg-emerald-600 hover:bg-emerald-500 text-white py-3 rounded-xl text-xs font-black transition-all shadow-lg shadow-emerald-900/20 flex justify-between px-4 items-center active:scale-95">
                        <span class="uppercase tracking-wider">ì—…ê·¸ë ˆì´ë“œ</span>
                        <span id="upgrade-cost" class="font-mono">â‚© 1,000,000</span>
                    </button>
                </div>

                <div class="glass-panel flex-grow p-6 rounded-3xl border border-slate-800 flex flex-col min-h-0">
                    <h3 class="font-black text-xl mb-4 flex items-center justify-between flex-shrink-0">
                        <span><span class="text-indigo-500 mr-2">â– </span>í™”ë¬¼ì°½ ì ì¬ í˜„í™©</span>
                        <span id="inventory-count" class="text-sm text-slate-500">0 ìœ ë‹›</span>
                    </h3>
                    <div id="inventory-list" class="space-y-3 flex-grow overflow-y-auto pr-1"></div>
                    
                    <div class="mt-4 pt-4 border-t border-slate-800 space-y-3 flex-shrink-0">
                        <div class="space-y-1">
                            <div class="flex justify-between text-[10px] font-bold px-1">
                                <span class="text-slate-500 italic">ê¸°ë³¸ ìœ ê°€ ë¹„ìš©</span>
                                <span id="base-fuel-display" class="text-slate-400">â‚© 0</span>
                            </div>
                            <div class="flex justify-between text-[10px] font-bold px-1">
                                <span class="text-slate-500 italic">ë¬´ê²Œ/íš¨ìœ¨ ì¡°ì •</span>
                                <span id="weight-penalty-display" class="text-amber-500">â‚© 0</span>
                            </div>
                            <div class="flex justify-between text-xs font-bold px-1 pt-1 border-t border-slate-800/50">
                                <span class="text-slate-500 uppercase">ì´ ì˜ˆìƒ í•­í•´ ë¹„ìš©</span>
                                <span id="est-fee" class="text-rose-400">â‚© 0</span>
                            </div>
                        </div>
                        <button onclick="triggerVoyage()" id="next-btn" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-black py-4 rounded-2xl transition-all shadow-2xl shadow-indigo-900/40 active:scale-95 text-lg">
                            ë‹¤ìŒ í•­êµ¬ë¡œ ì¶œí•­
                        </button>
                    </div>
                </div>
            </aside>
        </main>

        <div id="result-screen" class="hidden fixed inset-0 z-[200] bg-slate-950 flex items-center justify-center p-6">
            <div class="max-w-2xl w-full text-center">
                <div id="res-emoji" class="text-[120px] mb-8 animate-bounce"></div>
                <h1 class="text-6xl font-black mb-4 italic tracking-tighter">ì‘ì „ ì¢…ë£Œ</h1>
                <p id="res-rank" class="text-indigo-400 font-bold mb-10 text-2xl uppercase tracking-[0.4em]">ë“±ê¸‰ íŒì • ì¤‘...</p>
                <div class="grid grid-cols-2 gap-4 mb-10">
                    <div class="bg-slate-900 p-8 rounded-3xl border border-slate-800">
                        <p class="text-xs text-slate-500 mb-2 font-bold uppercase">ìµœì¢… ìì‚° ê°€ì¹˜</p>
                        <p id="res-money" class="text-3xl font-mono font-black text-white">â‚© 0</p>
                    </div>
                    <div class="bg-slate-900 p-8 rounded-3xl border border-slate-800">
                        <p class="text-xs text-slate-500 mb-2 font-bold uppercase">ìƒì¡´ ì¼ìˆ˜</p>
                        <p id="res-days" class="text-3xl font-mono font-black text-white">0 / 10</p>
                    </div>
                </div>
                <button onclick="location.reload()" class="w-full bg-white text-black font-black py-6 rounded-2xl text-xl hover:bg-slate-200 transition-colors">ê¸°ë¡ ì´ˆê¸°í™” í›„ ì¬ì‹œì‘</button>
            </div>
        </div>
    </div>

    <script>
        // --- Economy & Logic Configuration ---
        const MAX_DAYS = 10;
        const INITIAL_MONEY = 5000000;
        const STORAGE_FEE_BASE = 150000;
        const DAILY_QUOTA_BASE = 5;
        const FUEL_BASE_MULTIPLIER = 2100;
        const UNIVERSAL_TAX = 1.60;
        
        let shipLevel = 0;
        const MAX_SHIP_LEVEL = 5;
        const UPGRADE_EFFICIENCY = 0.12;

        const countries = {
            "ë¯¸êµ­": { icon: "ğŸ‡ºğŸ‡¸", dist: 1.5 },
            "ì¤‘êµ­": { icon: "ğŸ‡¨ğŸ‡³", dist: 0.8 },
            "ìœ ëŸ½": { icon: "ğŸ‡ªğŸ‡º", dist: 1.8 },
            "ì‚¬ìš°ë””": { icon: "ğŸ‡¸ğŸ‡¦", dist: 1.2 },
            "ì¼ë³¸": { icon: "ğŸ‡¯ğŸ‡µ", dist: 0.6 }
        };

        const items = [
            { id: 'gpu', name: "A100 í…ì„œ ì½”ì–´", base: 2200000, icon: "ğŸ“¼" },
            { id: 'lithium', name: "ì›ìì¬ ë¦¬íŠ¬", base: 850000, icon: "ğŸ”‹" },
            { id: 'oil', name: "ë¸Œë ŒíŠ¸ìœ ", base: 400000, icon: "ğŸ›¢ï¸" },
            { id: 'rolex', name: "í”Œë˜í‹°ë„˜ ì‹œê³„", base: 5500000, icon: "âŒš" },
            { id: 'wheat', name: "ìœ ì „ì ë°€", base: 120000, icon: "ğŸŒ¾" },
            { id: 'drone', name: "ì „ìˆ  ì •ì°° ë“œë¡ ", base: 3100000, icon: "ğŸ›¸" },
            { id: 'rare_earth', name: "ê³ ìˆœë„ í¬í† ë¥˜", base: 1500000, icon: "ğŸ’" },
            { id: 'vaccine', name: "ë²”ìš© mRNA ë°±ì‹ ", base: 600000, icon: "ğŸ’‰" },
            { id: 'carbon', name: "íƒ„ì†Œ ë°°ì¶œê¶Œ", base: 300000, icon: "ğŸƒ" },
            { id: 'wine', name: "ë¹ˆí‹°ì§€ ë¼í”¼íŠ¸", base: 4200000, icon: "ğŸ·" }
        ];

        // [ì‹œë‚˜ë¦¬ì˜¤ í’€] - analysis í•„ë“œ ì¶”ê°€
        const scenarioPool = [
            { h: "AGI(ì¸ê³µì¼ë°˜ì§€ëŠ¥) ê°œë°œ ì„ ì–¸", c: "ë¹…í…Œí¬ ê¸°ì—…ë“¤ì˜ ì°¨ì„¸ëŒ€ AI ì„¼í„° ê±´ì„¤ì´ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤. ë‚´ì¼ë¶€í„° GPU ìˆ˜ìš”ê°€ í­ì¦í•  ê²ƒì…ë‹ˆë‹¤.", analysis: "AI ì¸í”„ë¼ ê²½ìŸì´ ê³¼ì—´ë˜ë©´ì„œ í•µì‹¬ ë¶€í’ˆì¸ GPU ê°€ê²©ì´ ì²œì •ë¶€ì§€ë¡œ ì¹˜ì†Ÿì•˜ìŠµë‹ˆë‹¤.", oil: 95, eff: { item: 'gpu', mult: 2.5 } },
            { h: "êµ­ì œ ëª…í’ˆ ì†Œë¹„ ê¸ˆì§€ë ¹ ì˜ˆê³ ", c: "ì‚¬ì¹˜ì¬ì— ì§•ë²Œì  ì„¸ê¸ˆì´ ë¶€ê³¼ë˜ëŠ” ë²•ì•ˆì´ í†µê³¼ ì„ë°•í–ˆìŠµë‹ˆë‹¤. ì‹œê³„ì™€ ì™€ì¸ ê°€ê²©ì´ í­ë½í•  ì˜ˆì •ì…ë‹ˆë‹¤.", analysis: "ì„¸ê¸ˆ ë¶€ë‹´ì„ ìš°ë ¤í•œ ë¶€í˜¸ë“¤ì´ ì‚¬ì¹˜í’ˆì„ ì¼ì œíˆ íˆ¬ë§¤í•˜ë©´ì„œ ì‹œì¥ ê°€ê²©ì´ ë¶•ê´´ë˜ì—ˆìŠµë‹ˆë‹¤.", oil: 85, eff: { item: ['rolex', 'wine'], mult: 0.4 } },
            { h: "ì°¨ì„¸ëŒ€ ë°°í„°ë¦¬ ì—°êµ¬ ì‹¤íŒ¨", c: "ê¿ˆì˜ ë°°í„°ë¦¬ ì—°êµ¬ê°€ ì‹¤íŒ¨ë¡œ ëŒì•„ê°”ë‹¤ëŠ” ë£¨ë¨¸ê°€ ë•ë‹ˆë‹¤. ê¸°ì¡´ ë¦¬íŠ¬ ë°°í„°ë¦¬ ìˆ˜ìš”ê°€ ë‹¤ì‹œ ì˜¤ë¥¼ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.", analysis: "ëŒ€ì²´ì¬ ê°œë°œ ì‹¤íŒ¨ ì†Œì‹ì— ê¸°ì¡´ ë¦¬íŠ¬ ë°°í„°ë¦¬ ì˜ì¡´ë„ê°€ ë‹¤ì‹œ ë†’ì•„ì¡ŒìŠµë‹ˆë‹¤.", oil: 92, eff: { item: 'lithium', mult: 1.8 } },
            { h: "ì´ˆì „ë„ì²´ ìƒìš©í™” ë£¨ë¨¸", c: "ë‚´ì¼ ì•„ì¹¨ ì´ˆì „ë„ì²´ ê°œë°œ ê´€ë ¨ ì¤‘ëŒ€ ë°œí‘œê°€ ìˆìŠµë‹ˆë‹¤. í¬í† ë¥˜ ê´€ë ¨ì£¼ê°€ ìš”ë™ì¹  ê²ƒì…ë‹ˆë‹¤.", analysis: "ì´ˆì „ë„ì²´ ìƒì‚°ì— í•„ìˆ˜ì ì¸ í¬í† ë¥˜ í™•ë³´ ê²½ìŸì´ ë²Œì–´ì§€ë©° ê°€ê²©ì´ ê¸‰ë“±í–ˆìŠµë‹ˆë‹¤.", oil: 88, eff: { item: 'rare_earth', mult: 2.2 } },
            { h: "í•­êµ¬ ë„ì‹œ ì „ì—¼ë³‘ ê²½ë³´", c: "ë¯¸í™•ì¸ ë°”ì´ëŸ¬ìŠ¤ê°€ í¼ì§€ê³  ìˆìŠµë‹ˆë‹¤. ë°±ì‹  í™•ë³´ ì „ìŸì´ ì‹œì‘ë  ì¡°ì§ì…ë‹ˆë‹¤.", analysis: "íŒ¬ë°ë¯¹ ê³µí¬ë¡œ ì¸í•´ ê°êµ­ ì •ë¶€ê°€ ë°±ì‹  ì‚¬ì¬ê¸°ì— ë‚˜ì„°ìŠµë‹ˆë‹¤.", oil: 60, eff: { item: 'vaccine', mult: 3.0 } },
            { h: "ì¹œí™˜ê²½ ì—ë„ˆì§€ í˜‘ì•½ íŒŒê¸° ë…¼ì˜", c: "ì£¼ìš”êµ­ë“¤ì´ íƒ„ì†Œ ì¤‘ë¦½ í¬ê¸°ë¥¼ ë…¼ì˜ ì¤‘ì…ë‹ˆë‹¤. íƒ„ì†Œ ë°°ì¶œê¶Œ ê°€ê²© ë°©ì–´ê°€ í˜ë“¤ ê²ƒì…ë‹ˆë‹¤.", analysis: "í™˜ê²½ ê·œì œê°€ ë¬´ë ¥í™”ë˜ë©´ì„œ íƒ„ì†Œ ë°°ì¶œê¶Œì˜ ê°€ì¹˜ê°€ íœ´ì§€ì¡°ê°ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.", oil: 110, eff: { item: 'carbon', mult: 0.2 } },
            { h: "ì‚¬ë§‰ ì§€ì—­ ê¸´ì¥ ê³ ì¡°", c: "ì¤‘ë™ ì§€ì—­ì—ì„œ êµ°ì‚¬ì  ì›€ì§ì„ì´ í¬ì°©ë˜ì—ˆìŠµë‹ˆë‹¤. ë“œë¡  ìˆ˜ìš”ê°€ ê¸‰ì¦í•˜ê³  ìœ ê°€ê°€ ì˜¤ë¥¼ ê²ƒì…ë‹ˆë‹¤.", analysis: "ì „ìŸ ìœ„ê¸°ë¡œ ì¸í•´ ì •ì°° ë° ê³µê²©ìš© ë“œë¡  ì£¼ë¬¸ì´ ì‡„ë„í•˜ê³  ìˆìŠµë‹ˆë‹¤.", oil: 160, eff: { item: 'drone', mult: 2.2 } },
            { h: "ìœ ëŸ½ ëŒ€ê°€ë­„ ì˜ˆë³´", c: "ì˜¬í•´ ìœ ëŸ½ í¬ë„ ë†ì‚¬ê°€ ì „ë©¸í•  ê²ƒì´ë¼ëŠ” ê¸°ìƒ ì˜ˆë³´ê°€ ë–´ìŠµë‹ˆë‹¤. ì™€ì¸ í¬ì†Œì„±ì´ ê·¹ëŒ€í™”ë  ê²ƒì…ë‹ˆë‹¤.", analysis: "ìƒì‚°ëŸ‰ ê¸‰ê° ì˜ˆì¸¡ìœ¼ë¡œ ì¸í•´ ë¹ˆí‹°ì§€ ì™€ì¸ì˜ ê°€ì¹˜ê°€ ìˆ˜ì§ ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤.", oil: 95, eff: { item: 'wine', mult: 1.5 } },
            { h: "í•µìœµí•© ë°œì „ì†Œ ê°€ë™ ì„ë°•", c: "ë¬´í•œ ì²­ì • ì—ë„ˆì§€ ì‹œëŒ€ê°€ ë¨¸ì§€ì•Šì•˜ìŠµë‹ˆë‹¤. ì„ìœ ì™€ íƒ„ì†Œ ë°°ì¶œê¶Œì˜ ê°€ì¹˜ê°€ í•˜ë½í•  ì „ë§ì…ë‹ˆë‹¤.", analysis: "ê¿ˆì˜ ì—ë„ˆì§€ ìƒìš©í™” ê¸°ëŒ€ë¡œ ì¸í•´ êµ¬ì‹œëŒ€ ì—ë„ˆì§€ ìì›ë“¤ì´ ì™¸ë©´ë°›ê³  ìˆìŠµë‹ˆë‹¤.", oil: 40, eff: { item: ['oil', 'carbon'], mult: 0.3 } },
            { h: "ìš°ì£¼ ê´‘ë¬¼ ë„ì°© ì˜ˆì •", c: "ì†Œí–‰ì„± ì±„êµ´ì„ ì´ ë‚´ì¼ ì§€êµ¬ë¡œ ê·€í™˜í•©ë‹ˆë‹¤. ì—„ì²­ë‚œ ì–‘ì˜ í¬í† ë¥˜ê°€ ì‹œì¥ì— í’€ë¦´ ê²ƒì…ë‹ˆë‹¤.", analysis: "ìš°ì£¼ë°œ ê³µê¸‰ ê³¼ì‰ìœ¼ë¡œ ì¸í•´ í¬ì†Œ ìì›ë“¤ì˜ ê°€ê²©ì´ ì•ˆì •í™”(í•˜ë½)ë˜ì—ˆìŠµë‹ˆë‹¤.", oil: 90, eff: { item: 'rare_earth', mult: 0.5 } },
            { h: "ê¸€ë¡œë²Œ ë¬¼ë¥˜ ì‹œìŠ¤í…œ í•´í‚¹ ìœ„í˜‘", c: "í•´ì»¤ ê·¸ë£¹ì´ ë¬¼ë¥˜ë§ ê³µê²©ì„ ì˜ˆê³ í–ˆìŠµë‹ˆë‹¤. ë“œë¡  ë°°ì†¡ë§Œì´ ìœ ì¼í•œ ëŒ€ì•ˆì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.", analysis: "í•´ìš´ ë§ˆë¹„ ìš°ë ¤ë¡œ í•­ê³µ ë° ë“œë¡  ìš´ì†¡ ìˆ˜ë‹¨ì˜ ê°€ì¹˜ê°€ ì¬í‰ê°€ ë°›ì•˜ìŠµë‹ˆë‹¤.", oil: 110, eff: { item: 'drone', mult: 1.8 } },
            { h: "ê°€ìƒí™”í ê·œì œì•ˆ ë°œí‘œ ì˜ˆì •", c: "ì •ë¶€ê°€ ë‚´ì¼ ê°•ë ¥í•œ ì±„êµ´ ê·œì œë¥¼ ë°œí‘œí•©ë‹ˆë‹¤. GPUê°€ í—ê°’ì— ìŸì•„ì ¸ ë‚˜ì˜¬ ê²ƒì…ë‹ˆë‹¤.", analysis: "ì±„êµ´ì¥ íì‡„ë¡œ ì¸í•´ ì¤‘ê³  GPU ë¬¼ëŸ‰ì´ ì‹œì¥ì— ìŸì•„ì ¸ ë‚˜ì™”ìŠµë‹ˆë‹¤.", oil: 80, eff: { item: 'gpu', mult: 0.5 } },
            { h: "í˜¸ë¥´ë¬´ì¦ˆ í•´í˜‘ ë´‰ì‡„ ìœ„ê¸°", c: "ìœ ì¡°ì„  í†µí–‰ì´ ì œí•œë  ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤. ìœ ê°€ í­ë“±ì´ ì˜ˆìƒë©ë‹ˆë‹¤.", analysis: "ì „ ì„¸ê³„ì  ì—ë„ˆì§€ ê³µê¸‰ ì‡¼í¬ë¡œ ì¸í•´ ëª¨ë“  ë¬¼ë¥˜ ë¹„ìš©ê³¼ ì›ìì¬ ê°’ì´ ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤.", oil: 190, eff: { item: 'ALL', mult: 1.5 } },
            { h: "í‰ë²”í•œ ì‹œì¥ ìƒí™©", c: "íŠ¹ë³„í•œ ì´ìŠˆê°€ ì—†ëŠ” í‰ì˜¨í•œ ë‚ ì´ ì˜ˆìƒë©ë‹ˆë‹¤. ì‹œì¥ì€ ì•ˆì •ì ì¸ íë¦„ì„ ë³´ì¼ ê²ƒì…ë‹ˆë‹¤.", analysis: "íŠ¹ì´ ì‚¬í•­ ì—†ëŠ” ë³´í•©ì„¸ ì¥ì´ì—ˆìŠµë‹ˆë‹¤.", oil: 90, eff: { item: 'NONE', mult: 1.0 } }
        ];

        let currentDay = 1;
        let money = INITIAL_MONEY;
        let quota = DAILY_QUOTA_BASE;
        let inventory = {}; 
        let prices = {};
        
        let activeScenario = null; 
        let forecastScenario = null;
        
        let currentOil = 95;
        let selectedCountries = {}; 

        // Start Screen Logic
        function startGame() {
            document.getElementById('start-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('start-screen').style.display = 'none';
                document.getElementById('app').style.opacity = '1';
                init();
            }, 500);
        }

        function init() {
            items.forEach(item => {
                selectedCountries[item.id] = Object.keys(countries)[0];
            });

            // Day 1: í‰ë²”í•œ ì‹œì‘, ë‚´ì¼ ë‰´ìŠ¤ ì˜ˆë³´
            activeScenario = { h: "í•­í•´ ì‹œì‘", c: "", analysis: "ì²« ì¶œí•­ì…ë‹ˆë‹¤. ì‹œì¥ì€ ì•„ì§ ì¡°ìš©í•©ë‹ˆë‹¤.", oil: 95, eff: { item: 'NONE', mult: 1.0 } };
            forecastScenario = getRandomScenario();
            
            calculatePrices(); // ì´ˆê¸° ê°€ê²© ì„¤ì •
            render();
        }

        function getRandomScenario() {
            return scenarioPool[Math.floor(Math.random() * scenarioPool.length)];
        }

        // ê°€ê²© ê³„ì‚° ë¡œì§ (activeScenario ê¸°ì¤€)
        function calculatePrices() {
            currentOil = activeScenario.oil;
            
            items.forEach(item => {
                prices[item.id] = {};
                Object.keys(countries).forEach(cName => {
                    let basePrice = item.base * (0.85 + Math.random() * 0.3); // ê¸°ë³¸ ë³€ë™ì„±
                    basePrice *= UNIVERSAL_TAX;
                    
                    if (activeScenario.eff) {
                        const target = activeScenario.eff.item;
                        const mult = activeScenario.eff.mult;
                        
                        if (target === 'ALL') {
                            basePrice *= mult;
                        } else if (Array.isArray(target)) {
                            if (target.includes(item.id)) basePrice *= mult;
                        } else {
                            if (target === item.id) basePrice *= mult;
                        }
                    }
                    prices[item.id][cName] = Math.floor(basePrice / 100) * 100;
                });
            });
        }

        function calculateVoyageFees() {
            const totalItems = Object.values(inventory).reduce((a, b) => a + (b.qty || 0), 0);
            const baseFuelCost = Math.floor(currentOil * FUEL_BASE_MULTIPLIER);
            let rawFuelCost = Math.floor(baseFuelCost * Math.pow(1.10, totalItems));
            const discountRate = shipLevel * UPGRADE_EFFICIENCY;
            const discountedFuelCost = Math.floor(rawFuelCost * (1 - discountRate));
            const weightPenalty = discountedFuelCost - baseFuelCost;
            const storageTotal = totalItems * STORAGE_FEE_BASE;
            
            return {
                baseFuel: baseFuelCost,
                penalty: weightPenalty,
                storage: storageTotal,
                total: discountedFuelCost + storageTotal,
                items: totalItems
            };
        }

        function getUpgradeCost() { return 1000000 + (shipLevel * 1500000); }

        window.buyUpgrade = () => {
            if (shipLevel >= MAX_SHIP_LEVEL) return alert("ìµœëŒ€ ë ˆë²¨ ë„ë‹¬");
            const cost = getUpgradeCost();
            if (money < cost) return alert("ìê¸ˆ ë¶€ì¡±");
            money -= cost;
            shipLevel++;
            render();
        };

        function render() {
            document.getElementById('money-display').textContent = `â‚© ${money.toLocaleString()}`;
            document.getElementById('money-display').className = `text-2xl font-black font-mono italic ${money < 0 ? 'text-rose-500 animate-pulse' : 'text-emerald-400'}`;
            document.getElementById('oil-display').textContent = `$ ${currentOil.toFixed(2)}`;
            document.getElementById('day-display').textContent = `${String(currentDay).padStart(2, '0')} / ${MAX_DAYS}`;
            document.getElementById('fuel-eff-display').textContent = `${(shipLevel * UPGRADE_EFFICIENCY * 100).toFixed(0)}% ì ˆê°`;
            
            document.getElementById('quota-text').textContent = `${quota} / ${DAILY_QUOTA_BASE}`;
            document.getElementById('quota-progress').style.width = `${(quota / DAILY_QUOTA_BASE) * 100}%`;
            
            // Forecast News Display
            document.getElementById('news-headline').textContent = forecastScenario.h;
            document.getElementById('news-content').textContent = forecastScenario.c;

            // Render Market Grid
            const grid = document.getElementById('market-grid');
            grid.innerHTML = '';
            items.forEach(item => {
                const currentSelection = selectedCountries[item.id] || Object.keys(countries)[0];
                const currentPrice = prices[item.id][currentSelection];

                const card = document.createElement('div');
                card.className = "glass-panel p-5 rounded-2xl border border-slate-800 hover:border-indigo-500/50 transition-all group";
                
                const countryOpts = Object.keys(countries).map(c => {
                    const isSelected = c === currentSelection ? 'selected' : '';
                    return `<option value="${c}" ${isSelected}>${countries[c].icon} ${c}</option>`;
                }).join('');
                
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div class="p-3 bg-slate-900 rounded-xl group-hover:scale-110 transition-transform text-2xl">${item.icon}</div>
                        <div class="text-right">
                            <p class="text-[9px] font-black text-slate-500 uppercase tracking-widest">${item.id}</p>
                            <h4 class="font-bold text-sm text-white">${item.name}</h4>
                        </div>
                    </div>
                    <div class="bg-slate-950/80 p-3 rounded-xl mb-5 flex justify-between items-center border border-slate-800">
                        <select id="sel-${item.id}" onchange="updateItemPriceDisplay('${item.id}')" class="market-select bg-transparent text-xs font-bold text-indigo-400 outline-none w-24">
                            ${countryOpts}
                        </select>
                        <span id="pr-${item.id}" class="font-mono text-base font-black text-white italic">â‚© ${currentPrice.toLocaleString()}</span>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="executeTrade('${item.id}', 'buy')" class="bg-indigo-600 hover:bg-indigo-500 text-white py-3 rounded-xl text-[11px] font-black transition-all shadow-lg shadow-indigo-900/20 active:scale-95">ìˆ˜ì…í•˜ê¸°</button>
                        <button onclick="executeTrade('${item.id}', 'sell')" class="bg-slate-800 hover:bg-rose-600 text-slate-400 hover:text-white py-3 rounded-xl text-[11px] font-black transition-all border border-slate-700 active:scale-95">ë§¤ë„í•˜ê¸°</button>
                    </div>
                `;
                grid.appendChild(card);
            });

            // Inventory Rendering
            const invList = document.getElementById('inventory-list');
            invList.innerHTML = '';
            let hasItems = false;
            
            for(let id in inventory) {
                if(inventory[id].qty > 0) {
                    hasItems = true;
                    const itemData = items.find(i => i.id === id);
                    const selectedCountry = selectedCountries[id]; 
                    const currentMarketPrice = prices[id][selectedCountry]; 
                    const avgPrice = inventory[id].avgPrice;
                    
                    const profitRate = ((currentMarketPrice - avgPrice) / avgPrice) * 100;
                    const isProfit = profitRate >= 0;
                    const profitColor = isProfit ? "text-emerald-400" : "text-rose-400";
                    const profitSign = isProfit ? "+" : "";

                    invList.innerHTML += `
                        <div class="flex justify-between items-center bg-slate-900/40 p-3 rounded-2xl border border-slate-800/50 hover:bg-slate-800/60 transition-colors">
                            <div class="flex items-center gap-3">
                                <span class="text-xl">${itemData.icon}</span>
                                <div>
                                    <p class="text-xs font-bold text-white">${itemData.name}</p>
                                    <p class="text-[10px] text-slate-400">í‰ë‹¨: â‚©${Math.round(avgPrice).toLocaleString()}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="bg-indigo-500/10 text-indigo-400 px-2 py-0.5 rounded-full text-[10px] font-black font-mono mb-1 inline-block">x${inventory[id].qty}</span>
                                <p class="text-[10px] font-bold ${profitColor}">${profitSign}${profitRate.toFixed(1)}%</p>
                            </div>
                        </div>
                    `;
                }
            }
            
            const fees = calculateVoyageFees();
            document.getElementById('inventory-count').textContent = `${fees.items} ìœ ë‹›`;
            if(!hasItems) invList.innerHTML = '<div class="h-20 flex items-center justify-center border-2 border-dashed border-slate-800 rounded-2xl text-slate-700 text-xs italic">í™”ë¬¼ì°½ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</div>';
            
            document.getElementById('base-fuel-display').textContent = `â‚© ${fees.baseFuel.toLocaleString()}`;
            document.getElementById('weight-penalty-display').textContent = `${fees.penalty > 0 ? '+' : ''} â‚© ${fees.penalty.toLocaleString()}`;
            document.getElementById('est-fee').textContent = `â‚© ${fees.total.toLocaleString()}`;

            // Upgrade Button State
            const upBtn = document.getElementById('btn-upgrade');
            const upCostTag = document.getElementById('upgrade-cost');
            
            if (shipLevel >= MAX_SHIP_LEVEL) {
                upBtn.disabled = true;
                upBtn.classList.add('opacity-50', 'cursor-not-allowed');
                upBtn.querySelector('span:first-child').textContent = "MAX LEVEL";
                upCostTag.textContent = "-";
            } else {
                const cost = getUpgradeCost();
                upCostTag.textContent = `â‚© ${cost.toLocaleString()}`;
                if(money < cost) {
                    upBtn.classList.add('opacity-50');
                } else {
                    upBtn.classList.remove('opacity-50');
                }
            }
        }

        window.updateItemPriceDisplay = (id) => {
            const selectEl = document.getElementById(`sel-${id}`);
            const country = selectEl.value;
            selectedCountries[id] = country;
            document.getElementById(`pr-${id}`).textContent = `â‚© ${prices[id][country].toLocaleString()}`;
            if(inventory[id] && inventory[id].qty > 0) render(); 
        };

        window.executeTrade = (id, type) => {
            const country = document.getElementById(`sel-${id}`).value;
            const price = prices[id][country];
            
            if (type === 'buy') {
                if(quota <= 0) return alert("ì˜¤ëŠ˜ì˜ ê±°ë˜ í•œë„ ì´ˆê³¼");
                if(money < price) return alert("ìê¸ˆ ë¶€ì¡±");
                
                money -= price;
                if(!inventory[id]) inventory[id] = { qty: 0, avgPrice: 0 };
                
                const oldTotal = inventory[id].qty * inventory[id].avgPrice;
                inventory[id].qty++;
                inventory[id].avgPrice = (oldTotal + price) / inventory[id].qty;
                quota--;
            } else {
                if(!inventory[id] || inventory[id].qty <= 0) return alert("ë³´ìœ  ìˆ˜ëŸ‰ ì—†ìŒ");
                money += price;
                inventory[id].qty--;
                quota--; // ë§¤ë„ë„ ì¿¼í„° ì†Œëª¨
            }
            render();
        };

        // --- Core Turn Logic with Analysis Report ---
        window.triggerVoyage = () => {
            const fees = calculateVoyageFees();
            if(money < fees.total) return alert("í•­í•´ ë¹„ìš©ì„ ì§€ë¶ˆí•  ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤! (íŒŒì‚°)");
            
            // 1. Store Old Prices & Context for Report
            const oldPrices = JSON.parse(JSON.stringify(prices)); // Deep copy
            const happenedEvent = forecastScenario; // The forecast that just became reality
            
            // 2. Process Economic Turn
            money -= fees.total;
            currentDay++;
            quota = DAILY_QUOTA_BASE;

            // Shift Scenarios
            activeScenario = forecastScenario;
            forecastScenario = getRandomScenario();
            
            // 3. Calculate New Prices based on the event that happened
            calculatePrices();

            // 4. Generate & Show Report
            if (currentDay > MAX_DAYS) {
                showGameOver();
            } else {
                showDailyReport(happenedEvent, oldPrices, prices, fees.total);
            }
        };

        function showDailyReport(event, oldP, newP, cost) {
            const overlay = document.getElementById('report-overlay');
            const tbody = document.getElementById('report-table-body');
            
            // Fill Event Info
            document.getElementById('report-event-title').textContent = event.h;
            document.getElementById('report-analysis').textContent = event.analysis || "ì‹œì¥ ë³€ë™ ìš”ì¸ ë¶„ì„ ì¤‘...";
            document.getElementById('report-cost').textContent = `- â‚© ${cost.toLocaleString()}`;
            document.getElementById('report-balance').textContent = `â‚© ${money.toLocaleString()}`;
            document.getElementById('next-day-idx').textContent = currentDay;

            // Fill Table
            tbody.innerHTML = '';
            items.forEach(item => {
                // ëŒ€í‘œ êµ­ê°€(ë¯¸êµ­) ê¸°ì¤€ ê°€ê²© ë¹„êµ í˜¹ì€ í˜„ì¬ ì„ íƒëœ êµ­ê°€ ê¸°ì¤€
                const cKey = 'ë¯¸êµ­'; 
                const oldVal = oldP[item.id][cKey];
                const newVal = newP[item.id][cKey];
                const diff = newVal - oldVal;
                const rate = ((diff / oldVal) * 100).toFixed(1);
                
                let rateClass = "text-slate-400";
                if(diff > 0) rateClass = "text-rose-400 font-bold"; // Price Up is usually Red in stocks, let's stick to simple logic: Red=High Cost(Bad for buyer?), Green=Profit? 
                // Let's use generic: Red = Up, Blue = Down
                if(diff > 0) rateClass = "text-rose-500";
                if(diff < 0) rateClass = "text-emerald-500";

                const myQty = inventory[item.id] ? inventory[item.id].qty : 0;
                const holdingClass = myQty > 0 ? "bg-indigo-900/20 text-indigo-300 font-bold" : "text-slate-500";

                const row = `
                    <tr>
                        <td class="text-white font-bold flex items-center gap-2">
                            <span>${item.icon}</span> ${item.name}
                        </td>
                        <td class="text-slate-400 font-mono">â‚© ${oldVal.toLocaleString()}</td>
                        <td class="text-white font-mono">â‚© ${newVal.toLocaleString()}</td>
                        <td class="${rateClass} font-mono">${diff > 0 ? 'â–²' : diff < 0 ? 'â–¼' : '-'} ${Math.abs(rate)}%</td>
                        <td class="${holdingClass}">${myQty}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });

            overlay.style.display = 'flex';
        }

        window.continueToNextDay = () => {
            document.getElementById('report-overlay').style.display = 'none';
            render();
        };

        function showGameOver() {
            document.getElementById('app').style.opacity = '0.1';
            const screen = document.getElementById('result-screen');
            screen.classList.remove('hidden');
            
            const profit = money - INITIAL_MONEY;
            document.getElementById('res-money').textContent = `â‚© ${money.toLocaleString()}`;
            document.getElementById('res-days').textContent = `10 / 10`;

            let rank = "F";
            let emoji = "ğŸ’€";
            if (money <= 0) { rank = "BANKRUPT"; emoji = "ğŸ’¸"; }
            else if (profit < 0) { rank = "D"; emoji = "ğŸ“‰"; }
            else if (profit < 2000000) { rank = "C"; emoji = "âš“"; }
            else if (profit < 5000000) { rank = "B"; emoji = "ğŸš¢"; }
            else if (profit < 10000000) { rank = "A"; emoji = "ğŸ†"; }
            else { rank = "S (TYCOON)"; emoji = "ğŸ‘‘"; }

            document.getElementById('res-rank').textContent = `RANK: ${rank}`;
            document.getElementById('res-emoji').textContent = emoji;
        }

    </script>
</body>
</html>