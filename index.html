import random
import time

# 1. 아이템 및 초기 가격 설정
items = {
    "쌀": 1000,
    "반도체": 50000,
    "군용헬기": 2000000,
    "원유": 3000
}

# 2. 창의적인 뉴스 데이터베이스 (원인 -> 결과 로직 포함)
# 'effects'는 각 아이템 가격의 등락률을 의미합니다 (1.5 = 50% 상승, 0.7 = 30% 하락)
news_events = [
    {
        "title": "남태평양 해상 봉쇄... 제7함대 긴급 이동",
        "content": "A국과 B국 사이의 긴장이 최고조에 달했습니다. 해상 무역로가 차단될 위기입니다.",
        "image_desc": "[사진: 바다 위에 대치 중인 군함들과 멈춰선 상선들]",
        "type": "War",
        "effects": {"군용헬기": 1.5, "원유": 1.3, "쌀": 1.1, "반도체": 0.8} 
        # 해설: 전쟁나면 무기/기름값 폭등, 식량 사재기, 무역막혀서 반도체 수출 불가(하락)
    },
    {
        "title": "델타 곡창지대, 붉은 메뚜기 떼 습격",
        "content": "50년 만의 가뭄에 이어 메뚜기 떼가 농작물을 휩쓸고 있습니다.",
        "image_desc": "[사진: 황폐해진 논밭과 하늘을 뒤덮은 메뚜기 떼]",
        "type": "Climate",
        "effects": {"쌀": 2.0, "군용헬기": 1.0, "원유": 1.0, "반도체": 1.0}
        # 해설: 쌀 공급 부족으로 가격 2배 폭등, 나머지는 영향 없음
    },
    {
        "title": "AI 윤리 협약 타결, '고성능 칩' 규제 완화",
        "content": "세계 각국이 AI 개발 제한을 풀기로 합의했습니다. 기술 경쟁이 가속화될 전망입니다.",
        "image_desc": "[사진: 최첨단 데이터 센터와 웃고 있는 엔지니어들]",
        "type": "Tech",
        "effects": {"반도체": 1.4, "군용헬기": 1.1, "원유": 1.05, "쌀": 1.0}
        # 해설: 반도체 수요 폭발, 첨단 무기 수요 소폭 증가
    }
]

def play_turn(day):
    print(f"\n{'='*20} [Day {day}] 아침이 밝았습니다 {'='*20}")
    
    # 1. 오늘의 뉴스 발생 (랜덤)
    todays_event = random.choice(news_events)
    
    # 뉴스 출력 (플레이어에게 힌트 제공)
    print(f"\n📰 [오늘의 헤드라인] {todays_event['title']}")
    print(f"{todays_event['image_desc']}") # 게임 엔진에서는 실제 이미지를 띄움
    print(f"내용: {todays_event['content']}")
    print("-" * 60)
    
    # 플레이어의 추론 및 행동 (입력 예시)
    print(f"현재 보유 자금: 10,000,000원")
    print(f"현재 시세: {items}")
    user_choice = input("어떤 종목을 매수하시겠습니까? (쌀/반도체/군용헬기/원유/패스): ")
    
    print("\n... 하루가 지나는 중 (시뮬레이션) ...")
    time.sleep(1) # 긴장감 조성
    
    # 2. 시장 가격 변동 적용 로직
    # 기존 가격 * 뉴스의 영향력 * 약간의 랜덤 변동성(0.95 ~ 1.05)
    old_prices = items.copy() # 기록용
    
    for item_name in items:
        effect = todays_event['effects'].get(item_name, 1.0) # 영향 없으면 1.0
        random_fluctuation = random.uniform(0.95, 1.05) # ±5% 자연 변동
        
        # 가격 업데이트
        items[item_name] = int(items[item_name] * effect * random_fluctuation)

    # 3. 상세 결과 리포트 (요청하신 부분)
    show_daily_report(day, todays_event, old_prices, items, user_choice)

def show_daily_report(day, event, old_prices, new_prices, user_choice):
    """
    단순 결과가 아닌, 왜 올랐는지 '시장 분석'을 포함한 상세 리포트
    """
    print(f"\n\n📊 [{'Day ' + str(day)} 마감 리포트] 📊")
    print(f"이슈: {event['title']}")
    print("-" * 50)
    
    # 주요 등락 품목 분석
    print("📈 [시장 분석]")
    if event['type'] == 'War':
        print("  📢 분석가 코멘트: \"전쟁 위기로 인해 안전자산과 군수물자 수요가 폭증했습니다!\"")
    elif event['type'] == 'Climate':
        print("  📢 분석가 코멘트: \"기후 재난으로 식량 공급망이 붕괴되어 곡물가가 치솟았습니다.\"")
    elif event['type'] == 'Tech':
        print("  📢 분석가 코멘트: \"기술 규제 완화로 IT 섹터에 막대한 자금이 유입되었습니다.\"")
    
    print("-" * 50)
    print(f"{'품목':<10} | {'어제 가격':<10} | {'오늘 가격':<10} | {'변동률':<10}")
    print("-" * 50)
    
    for item in old_prices:
        change = new_prices[item] - old_prices[item]
        rate = (change / old_prices[item]) * 100
        sign = "🔺" if change > 0 else "blue🔻" if change < 0 else "-"
        
        # 유저가 선택한 종목은 강조 표시
        highlight = "👈 (내 투자)" if item == user_choice else ""
        
        print(f"{item:<10} | {old_prices[item]:<10,} | {new_prices[item]:<10,} | {sign} {rate:.1f}% {highlight}")

    print("-" * 50)
    
    # 플레이어 결과
    if user_choice in new_prices:
        profit = (new_prices[user_choice] - old_prices[user_choice])
        print(f"💡 당신의 선택: [{user_choice}]")
        if profit > 0:
            print(f"🎉 성공! 예측이 적중하여 주당 {profit:,}원의 이득을 봤습니다!")
        elif profit < 0:
            print(f"😭 실패... 주당 {abs(profit):,}원의 손실을 입었습니다.")
        else:
            print(f"😐 보합. 가격 변동이 거의 없었습니다.")
    else:
        print("💤 관망하였습니다. 자산 변동 없음.")

# 게임 실행 테스트
play_turn(1)